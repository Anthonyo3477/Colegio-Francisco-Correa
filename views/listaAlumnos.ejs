<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <title>Listado de Alumnos</title>
    <link rel="stylesheet" href="/css/listaAlumnos.css">
</head>

<body>
    <!-- Navbar -->
    <%- include('partials/navbar') %>

        <header>
            <h1>Colegio Manuel Francisco Correa</h1>
            <p>Bienvenidos a nuestra comunidad educativa</p>
        </header>

        <main>
            <h2 style="text-align:center;">Listado de Alumnos</h2>

            <!-- Filtro para los cursos -->

            <table>
                <thead>
                    <tr>
                        <th>RUT</th>
                        <th>Nombre</th>
                        <th>Apellido Paterno</th>
                        <th>Apellido Materno</th>
                        <th>Curso</th>
                        <th>Fecha Ingreso</th>
                        <th>Nacionalidad</th>
                        <th>Orden Llegada</th>
                        <th>Direcci√≥n</th>
                        <th>Comuna</th>
                        <th>Apoderados</th> <!-- Nueva columno, aca deberia de verse el nombre del apoderado -->
                        <th>Opciones</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (alumnos && alumnos.length> 0) { %>
                        <% alumnos.forEach(alumno=> { %>
                            <tr>
                                <td>
                                    <%= alumno.rut_alumnos %>
                                </td>
                                <td>
                                    <%= alumno.nombre %>
                                </td>
                                <td>
                                    <%= alumno.apellido_paterno %>
                                </td>
                                <td>
                                    <%= alumno.apellido_materno %>
                                </td>
                                <td>
                                    <%= alumno.curso %>
                                </td>
                                <td>
                                    <%= alumno.fecha_ingreso %>
                                </td>
                                <td>
                                    <%= alumno.nacionalidad %>
                                </td>
                                <td>
                                    <%= alumno.orden_llegada %>
                                </td>
                                <td>
                                    <%= alumno.direcion %>
                                </td>
                                <td>
                                    <%= alumno.comuna %>
                                </td>

                                <!-- Lista apoderado -->
                                <td>
                                    <% if (alumno.apoderados && alumno.apoderados.length) { %>
                                        <ul style="margin:0; padding-left:18px;">
                                            <% alumno.apoderados.forEach(ap=> { %>
                                                <li>
                                                    <strong>
                                                        <%= ap.nombre_apoderado %>
                                                    </strong>
                                                    <small>
                                                        <%= ap.apellido_paterno %>
                                                            <%= ap.apellido_materno %> |
                                                                Tel: <%= ap.telefono %>
                                                                    <% if (ap.correo) { %> | <%= ap.correo %>
                                                                            <% } %>
                                                    </small>
                                                </li>
                                                <% }) %>
                                        </ul>
                                        <% } else { %>
                                            <em>Sin apoderados</em>
                                            <% } %>
                                </td>

                                <td>
                                    <a href="/editar/<%= alumno.id %>" class="btn btn-sm btn-warning">Modificar</a>
                                    <form action="/eliminar/<%= alumno.id %>" method="POST" style="display:inline;">
                                        <button type="submit" class="btn btn-sm btn-danger">Eliminar</button>
                                    </form>
                                </td>
                            </tr>
                            <% }) %>
                                <% } else { %>
                                    <tr>
                                        <td colspan="12" style="text-align:center;">No hay alumnos registrados</td>
                                    </tr>
                                    <% } %>
                </tbody>

            </table>

            <button type="button" onclick="window.history.back()" class="btn-volver">Volver</button>
        </main>

        <!-- Footer -->
        <%- include('partials/footer') %>
</body>

</html>